# Using the Templates and Handlebars Helpers Provided by This Package.

This package provides a handful of [Handlebars "partials"](http://handlebarsjs.com/partials.html), which can be used
within your templates.  To use these, you will need to add this package's template directory to your renderer
configuration and load the helpers provided by this package, as shown in the following example:

```javascript
var fluid = require("infusion");
var my = fluid.registerNamespace("my");

fluid.require("%gpii-diff");

fluid.defaults("my.renderer", {
    type: "gpii.handlebars.standaloneRenderer",
    templateDirs: ["%gpii-diff/tests/templates", "%gpii-diff/src/templates"],
    components: {
        isDiffArray: {
            type: "gpii.diff.helper.isDiffArray"
        },
        hasChanged: {
            type: "gpii.diff.helper.hasChanged"
        },
        leftValue: {
            type: "gpii.diff.helper.leftValue"
        },
        rightValue: {
            type: "gpii.diff.helper.rightValue"
        }
    }
});

var renderer = my.renderer();
var text = renderer.render("diff-text", gpii.diff.compare("old", "new")); // Returns "-old-+new+\n"
```

To use many of the templates included in this package, your handlebars instance will need to be made aware of the
`isArrayDiff` handlebars helper provided by this package (see below).  The preceding example also adds this to our
renderer.

If you only wish to render a single comparison, you can use the `diff` or `diff-text` page to generate HTML
or text respectively. These will call the appropriate partials to render a single variable as either HTML or text. See
[the tutorial](tutorial.md) for more detailed examples, including examples of how to call the relevant partials
directly.

## Helpers

### The `hasChanged` helper

The `hasChanged` block helper allows you to optionally display content if a particular diff segment has or has not
changed.  Here's a sample snippet from a handlebars template:

```handlebars
{{#hasChanged diff.segment}}
    There were changes.
{{else}}
    There were no changes.
{{/hasChanged}}
```

### The `leftValue` helper

The `leftValue` helper outputs only the left side of a particular diff. If `diff.segment` is equal to `[{ type:
"removed", value: "old"}, { type: "added", value: "new"}, { type: "unchanged", value: " string"}]`, then the template
snippet `{{leftValue diff.segment}}` would be rendered as `"old string"`.

### The `rightValue` helper

The `righttValue` helper outputs only the right side of a particular diff. If `diff.segment` is equal to `[{ type:
"removed", value: "old"}, { type: "added", value: "new"}, { type: "unchanged", value: " string"}]`, then the template
snippet `{{leftValue diff.segment}}` would be rendered as `"new string"`.

## This Package's HTML Output

The HTML output generated by this package is intended to be visually distinct, but also to convey changes to users who
rely on screen readers.  To do either, you will need to include the CSS file included in this package under
`src/css/gpii-diff.css`.  Here is an expanded and indented view of a single change from "old" to "new":

```html
<del>
    <img class="gpii-diff-zeropx" aria-label="Begin deleted content."/>
    old
    <img class="gpii-diff-zeropx" aria-label="End deleted content."/>
</del>
<ins>
    <img class="gpii-diff-zeropx" aria-label="Begin inserted content."/>
    new
    <img class="gpii-diff-zeropx" aria-label="End inserted content."/>
</ins>
```

As demonstrated here, the strategy we use is to wrap insertions in the html `<ins>` tag, and to wrap deletions in the
html `<del>` tag. Changes are surrounded by zero pixel images that include screen reader labels.  In our testing using
both standalone pages and HTML emails as filtered by GMail, this strategy provides the best balance of visual
distinctiveness and screen reader compatibility.

On Mac OS X High Sierra with VoiceOver and current versions of Opera, Safari, Firefox, and Chrome, all changes are
announced as expected.  On Windows 10 using NVDA and current versions of IE, Edge, and Chrome, all changes are announced
as expected.  Of all configurations tested, only Firefox and NVDA on Windows do not work as expected.
